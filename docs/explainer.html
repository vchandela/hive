<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hive ‚Äî Retrieval Engine with Verifiable Feedback Loops</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        card: '#1e293b',
                        border: '#334155',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fill-bar {
            0% { width: 35%; background: #ef4444; }
            50% { width: 58%; background: #eab308; }
            100% { width: 75%; background: #22c55e; }
        }
        .animate-fill { animation: fill-bar 3s ease-in-out forwards; }
        .card-expand { transition: max-height 0.3s ease, opacity 0.3s ease; max-height: 0; opacity: 0; overflow: hidden; }
        .card-expand.open { max-height: 500px; opacity: 1; }
    </style>
</head>
<body class="bg-dark text-gray-200 font-sans">

<!-- Hero: The Problem -->
<section class="min-h-screen flex flex-col justify-center px-6 py-20 max-w-5xl mx-auto">
    <h1 class="text-4xl md:text-5xl font-bold text-white mb-6">
        Your AI Agent Is Being Sabotaged<br>by Its Own Search Results
    </h1>
    <p class="text-lg text-gray-400 mb-12 max-w-2xl">
        When an LLM retrieves context, a result that <em>looks right but is wrong</em> doesn't just waste a slot ‚Äî it actively corrupts reasoning. Traditional metrics can't see this. Hive can.
    </p>

    <!-- Search results visualization -->
    <div class="space-y-3 mb-12 max-w-xl">
        <div class="flex items-center gap-3 bg-green-900/30 border border-green-700/50 rounded-lg px-4 py-3">
            <span class="text-green-400 font-mono text-sm w-6">#1</span>
            <span class="flex-1">API Authentication: Bearer Tokens & API Keys</span>
            <span class="text-green-400 text-xs font-semibold px-2 py-0.5 bg-green-900/50 rounded">RELEVANT</span>
        </div>
        <div class="flex items-center gap-3 bg-red-900/30 border border-red-700/50 rounded-lg px-4 py-3">
            <span class="text-red-400 font-mono text-sm w-6">#2</span>
            <span class="flex-1">Authentication FAQ: Password Reset & 2FA Setup</span>
            <span class="text-red-400 text-xs font-semibold px-2 py-0.5 bg-red-900/50 rounded flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                DISTRACTOR
            </span>
        </div>
        <div class="flex items-center gap-3 bg-green-900/30 border border-green-700/50 rounded-lg px-4 py-3">
            <span class="text-green-400 font-mono text-sm w-6">#3</span>
            <span class="flex-1">API Authentication: Token Refresh</span>
            <span class="text-green-400 text-xs font-semibold px-2 py-0.5 bg-green-900/50 rounded">RELEVANT</span>
        </div>
        <div class="flex items-center gap-3 bg-gray-800 border border-gray-700/50 rounded-lg px-4 py-3">
            <span class="text-gray-500 font-mono text-sm w-6">#4</span>
            <span class="flex-1 text-gray-500">Rate Limits: Handling 429 Errors</span>
            <span class="text-gray-500 text-xs px-2 py-0.5 bg-gray-800 rounded">IRRELEVANT</span>
        </div>
        <div class="flex items-center gap-3 bg-green-900/30 border border-green-700/50 rounded-lg px-4 py-3">
            <span class="text-green-400 font-mono text-sm w-6">#5</span>
            <span class="flex-1">SDK Authentication Configuration</span>
            <span class="text-green-400 text-xs font-semibold px-2 py-0.5 bg-green-900/50 rounded">RELEVANT</span>
        </div>
    </div>

    <div class="bg-card border border-border rounded-lg p-4 mb-8 max-w-xl">
        <p class="text-gray-400 text-sm">
            The red card shares keywords with the query ("authentication") but answers a completely different question (password resets, not API tokens). When the LLM reads it, it contaminates the answer. This is <strong class="text-white">Mutually Assured Distraction (MAD)</strong>.
        </p>
    </div>

    <!-- nDCG vs nUDCG -->
    <div class="flex flex-col md:flex-row gap-4 max-w-xl">
        <div class="flex-1 bg-green-900/20 border border-green-700/40 rounded-lg p-6 text-center">
            <div class="text-sm text-green-400 font-semibold mb-1">nDCG says</div>
            <div class="text-3xl font-bold text-green-400">0.75</div>
            <div class="text-xs text-green-400/60 mt-1">"Looks fine"</div>
        </div>
        <div class="flex-1 bg-amber-900/20 border border-amber-700/40 rounded-lg p-6 text-center">
            <div class="text-sm text-amber-400 font-semibold mb-1">nUDCG says</div>
            <div class="text-3xl font-bold text-amber-400">0.35</div>
            <div class="text-xs text-amber-400/60 mt-1">"Reveals the problem"</div>
        </div>
    </div>
</section>

<!-- The Feedback Loop -->
<section class="px-6 py-20 max-w-5xl mx-auto">
    <h2 class="text-3xl font-bold text-white mb-4">The Feedback Loop</h2>
    <p class="text-gray-400 mb-10 max-w-2xl">The agent writes configs, measures results, and iterates ‚Äî like a developer running tests after each code change.</p>

    <div class="flex flex-col md:flex-row gap-4 mb-10">
        <div class="flex-1 bg-card border border-border rounded-lg p-5 cursor-pointer" onclick="toggleDetail('d1')">
            <div class="flex items-center gap-3 mb-2">
                <span class="text-2xl">üìù</span>
                <span class="font-semibold text-white">1. Config</span>
            </div>
            <p class="text-sm text-gray-400">Agent writes a JSON config controlling search behavior</p>
            <div id="d1" class="card-expand mt-3 text-xs text-gray-500">
                The config specifies: method (keyword, vector, hybrid), how many results, what filters to apply, whether to enable dynamic-k and distraction detection. It's a file on disk ‚Äî versioned, diffable, reviewable.
            </div>
        </div>
        <div class="flex-1 bg-card border border-border rounded-lg p-5 cursor-pointer" onclick="toggleDetail('d2')">
            <div class="flex items-center gap-3 mb-2">
                <span class="text-2xl">üîç</span>
                <span class="font-semibold text-white">2. Search</span>
            </div>
            <p class="text-sm text-gray-400">Hive runs the search with ranked results and scores</p>
            <div id="d2" class="card-expand mt-3 text-xs text-gray-500">
                Combines BM25 (keyword) and vector (semantic) search via Reciprocal Rank Fusion. Optionally flags results where the two methods disagree ‚Äî a signal of potential distractors.
            </div>
        </div>
        <div class="flex-1 bg-card border border-border rounded-lg p-5 cursor-pointer" onclick="toggleDetail('d3')">
            <div class="flex items-center gap-3 mb-2">
                <span class="text-2xl">üìä</span>
                <span class="font-semibold text-white">3. Evaluate</span>
            </div>
            <p class="text-sm text-gray-400">Scores results against known-good answers using UDCG</p>
            <div id="d3" class="card-expand mt-3 text-xs text-gray-500">
                UDCG assigns +1 to relevant results, -1 to distractors, and 0 to irrelevant ones. Each is weighted by rank position ‚Äî top ranks matter most. The resulting score reveals problems that nDCG hides.
            </div>
        </div>
        <div class="flex-1 bg-card border border-border rounded-lg p-5 cursor-pointer" onclick="toggleDetail('d4')">
            <div class="flex items-center gap-3 mb-2">
                <span class="text-2xl">üß†</span>
                <span class="font-semibold text-white">4. Reason</span>
            </div>
            <p class="text-sm text-gray-400">Agent reads scores and identifies what went wrong</p>
            <div id="d4" class="card-expand mt-3 text-xs text-gray-500">
                The LLM sees: "nUDCG is 0.38, 2 distractors from FAQs." It reasons: "FAQ documents share keywords with API docs but answer different questions. I should filter them out or enable distraction detection."
            </div>
        </div>
        <div class="flex-1 bg-card border border-border rounded-lg p-5 cursor-pointer" onclick="toggleDetail('d5')">
            <div class="flex items-center gap-3 mb-2">
                <span class="text-2xl">üîß</span>
                <span class="font-semibold text-white">5. Improve</span>
            </div>
            <p class="text-sm text-gray-400">Agent writes a new config and the loop repeats</p>
            <div id="d5" class="card-expand mt-3 text-xs text-gray-500">
                The new config might enable category filtering, turn on dynamic-k, or adjust disagreement thresholds. It's validated before evaluation ‚Äî just like compiling code before running tests.
            </div>
        </div>
    </div>

    <!-- Progress bar -->
    <div class="max-w-xl">
        <div class="flex justify-between text-sm text-gray-400 mb-2">
            <span>nUDCG Progress</span>
            <span>0.35 ‚Üí 0.58 ‚Üí 0.75</span>
        </div>
        <div class="w-full bg-gray-800 rounded-full h-4 overflow-hidden" id="progress-bar-container">
            <div class="h-full rounded-full animate-fill" style="width: 35%"></div>
        </div>
    </div>
</section>

<!-- Three-Level Verification -->
<section class="px-6 py-20 max-w-5xl mx-auto">
    <h2 class="text-3xl font-bold text-white mb-4">Three-Level Verification</h2>
    <p class="text-gray-400 mb-10 max-w-2xl">Every config change goes through the same verification pipeline ‚Äî like compiling, linting, and testing code.</p>

    <div class="space-y-4 max-w-2xl">
        <div class="bg-card border border-border rounded-lg p-6">
            <div class="flex items-center gap-3 mb-3">
                <span class="w-8 h-8 rounded-full bg-blue-900/50 flex items-center justify-center text-blue-400">‚úì</span>
                <h3 class="text-lg font-semibold text-white">Syntactic</h3>
                <span class="text-xs text-gray-500 ml-auto">Like a compiler</span>
            </div>
            <p class="text-sm text-gray-400 mb-2">Does the config parse correctly?</p>
            <div class="bg-gray-900/50 rounded px-3 py-2 text-xs font-mono text-gray-500">
                ‚úì top_k is a positive integer &nbsp; ‚úì method is keyword|vector|hybrid &nbsp; ‚úì all required fields present
            </div>
        </div>

        <div class="bg-card border border-border rounded-lg p-6">
            <div class="flex items-center gap-3 mb-3">
                <span class="w-8 h-8 rounded-full bg-purple-900/50 flex items-center justify-center text-purple-400">üß†</span>
                <h3 class="text-lg font-semibold text-white">Semantic</h3>
                <span class="text-xs text-gray-500 ml-auto">Like a linter</span>
            </div>
            <p class="text-sm text-gray-400 mb-2">Do the settings make logical sense together?</p>
            <div class="bg-red-900/20 border border-red-900/30 rounded px-3 py-2 text-xs font-mono text-red-400">
                ‚úó distraction_detection.enabled is true but method is "keyword". Distraction detection requires "hybrid" to compare keyword vs vector rankings.
            </div>
        </div>

        <div class="bg-card border border-border rounded-lg p-6">
            <div class="flex items-center gap-3 mb-3">
                <span class="w-8 h-8 rounded-full bg-green-900/50 flex items-center justify-center text-green-400">üõ°</span>
                <h3 class="text-lg font-semibold text-white">Behavioral</h3>
                <span class="text-xs text-gray-500 ml-auto">Like a test suite</span>
            </div>
            <p class="text-sm text-gray-400 mb-2">Does it actually perform better?</p>
            <div class="bg-red-900/20 border border-red-900/30 rounded px-3 py-2 text-xs font-mono text-red-400">
                Deploy BLOCKED: candidate nUDCG (0.34) &lt; active nUDCG (0.61). The system refuses to make search quality worse.
            </div>
        </div>
    </div>
</section>

<!-- The Demo Story -->
<section class="px-6 py-20 max-w-5xl mx-auto">
    <h2 class="text-3xl font-bold text-white mb-4">The Demo Story</h2>
    <p class="text-gray-400 mb-10 max-w-2xl">An AI agent starts with a naive config and optimizes it in 3 steps ‚Äî zero human intervention.</p>

    <div class="flex flex-col md:flex-row gap-6 mb-8">
        <div class="flex-1 bg-card border border-border rounded-lg p-6">
            <div class="text-xs text-gray-500 mb-2">Act 1</div>
            <h3 class="text-lg font-semibold text-white mb-1">v1: Naive Baseline</h3>
            <p class="text-sm text-gray-400 mb-4">Hybrid search, top-k=10, no filtering, no dynamic-k</p>
            <div class="flex justify-between items-end">
                <div>
                    <div class="text-xs text-gray-500">nUDCG</div>
                    <div class="text-2xl font-bold text-red-400">0.35</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-500">Distractors</div>
                    <div class="text-2xl font-bold text-red-400">4</div>
                </div>
            </div>
        </div>

        <div class="flex-1 bg-card border border-border rounded-lg p-6">
            <div class="text-xs text-gray-500 mb-2">Act 2</div>
            <h3 class="text-lg font-semibold text-white mb-1">v2: Filter + Detect</h3>
            <p class="text-sm text-gray-400 mb-4">Agent excludes FAQ category, enables distraction detection</p>
            <div class="flex justify-between items-end">
                <div>
                    <div class="text-xs text-gray-500">nUDCG</div>
                    <div class="text-2xl font-bold text-yellow-400">0.58</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-500">Distractors</div>
                    <div class="text-2xl font-bold text-yellow-400">1</div>
                </div>
            </div>
        </div>

        <div class="flex-1 bg-card border border-border rounded-lg p-6">
            <div class="text-xs text-gray-500 mb-2">Act 3</div>
            <h3 class="text-lg font-semibold text-white mb-1">v3: Dynamic-k</h3>
            <p class="text-sm text-gray-400 mb-4">Agent enables gap-based cutoff ‚Äî fewer results, higher quality</p>
            <div class="flex justify-between items-end">
                <div>
                    <div class="text-xs text-gray-500">nUDCG</div>
                    <div class="text-2xl font-bold text-green-400">0.75</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-500">Distractors</div>
                    <div class="text-2xl font-bold text-green-400">0</div>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-green-900/20 border border-green-700/40 rounded-lg p-4 max-w-2xl">
        <p class="text-green-400 font-semibold">
            Result: nUDCG improved 114% (0.35 ‚Üí 0.75). Distractors eliminated (4 ‚Üí 0). Zero human intervention.
        </p>
    </div>
</section>

<!-- Architecture -->
<section class="px-6 py-20 max-w-5xl mx-auto">
    <h2 class="text-3xl font-bold text-white mb-4">How It Works</h2>
    <p class="text-gray-400 mb-10 max-w-2xl">Everything runs locally. SQLite for storage, Python for the engine, JSON files for configs.</p>

    <div class="bg-card border border-border rounded-lg p-8 overflow-x-auto">
        <pre class="mermaid">
flowchart TD
    subgraph workspace [Workspace: Files on Disk]
        Collections["collections/*.json"]
        Configs["configs/*.json"]
        ActiveConfig["configs/active.json"]
        Documents["documents/*.md"]
        Evals["evals/golden.json"]
    end

    subgraph engine [Hive Engine]
        Validator["Validator\n(syntactic + semantic + behavioral)"]
        Indexer["Indexer\n(chunk + BM25 + embed)"]
        Searcher["Searcher\n(RRF + dynamic-k + disagreement)"]
        Evaluator["Evaluator\n(UDCG + comparison)"]
    end

    subgraph storage [SQLite: hive.db]
        ChunksTable["chunks"]
        PostingsTable["postings + term_stats"]
        ConfigHistory["config_versions"]
        EvalResults["eval_results"]
    end

    CLI["CLI: validate | index | query | evaluate | compare | deploy"]

    CLI --> Validator
    CLI --> Indexer
    CLI --> Searcher
    CLI --> Evaluator

    Validator --> Configs
    Indexer --> Documents
    Searcher --> ChunksTable
    Evaluator --> Evals
        </pre>
    </div>
</section>

<!-- Key Concepts -->
<section class="px-6 py-20 max-w-5xl mx-auto">
    <h2 class="text-3xl font-bold text-white mb-4">Key Concepts</h2>
    <p class="text-gray-400 mb-10 max-w-2xl">Quick reference for non-technical readers.</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-3xl">
        <div class="bg-card border border-border rounded-lg p-5">
            <h3 class="font-semibold text-white mb-2">UDCG</h3>
            <p class="text-sm text-gray-400">A search quality score that <strong class="text-gray-300">penalizes wrong answers</strong>, not just rewards right ones. Traditional nDCG treats distractors as harmless zeros.</p>
        </div>
        <div class="bg-card border border-border rounded-lg p-5">
            <h3 class="font-semibold text-white mb-2">Distractor</h3>
            <p class="text-sm text-gray-400">A search result that <strong class="text-gray-300">looks right but means something different</strong>. Like finding "Password Reset FAQ" when you searched for "API Authentication."</p>
        </div>
        <div class="bg-card border border-border rounded-lg p-5">
            <h3 class="font-semibold text-white mb-2">Dynamic-k</h3>
            <p class="text-sm text-gray-400">Instead of always returning 10 results, <strong class="text-gray-300">stop when quality drops off a cliff</strong>. Fewer results = fewer chances for distractors to sneak in.</p>
        </div>
        <div class="bg-card border border-border rounded-lg p-5">
            <h3 class="font-semibold text-white mb-2">RRF (Reciprocal Rank Fusion)</h3>
            <p class="text-sm text-gray-400">A way to <strong class="text-gray-300">combine keyword search and meaning search</strong> without worrying about incompatible score scales. Rank-based, not score-based.</p>
        </div>
        <div class="bg-card border border-border rounded-lg p-5">
            <h3 class="font-semibold text-white mb-2">Deploy Gate</h3>
            <p class="text-sm text-gray-400">The system <strong class="text-gray-300">refuses to deploy a config that makes search quality worse</strong>. Like a CI pipeline that blocks merging if tests fail.</p>
        </div>
        <div class="bg-card border border-border rounded-lg p-5">
            <h3 class="font-semibold text-white mb-2">Feedback Loop</h3>
            <p class="text-sm text-gray-400">The agent <strong class="text-gray-300">tries, measures, learns, and tries again</strong>. Like a developer running tests after each code change ‚Äî but fully automated.</p>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="px-6 py-12 text-center text-gray-600 text-sm border-t border-border">
    <p>Hive ‚Äî An OSS Retrieval Engine with Verifiable Feedback Loops</p>
    <p class="mt-2">
        <a href="https://github.com" class="text-blue-400 hover:underline">GitHub</a> ¬∑
        Built with SQLite, Python, and first-principles thinking
    </p>
</footer>

<script>
    mermaid.initialize({
        startOnLoad: true,
        theme: 'dark',
        themeVariables: {
            primaryColor: '#1e293b',
            primaryBorderColor: '#334155',
            lineColor: '#64748b',
            textColor: '#e2e8f0',
        }
    });

    function toggleDetail(id) {
        const el = document.getElementById(id);
        el.classList.toggle('open');
    }

    // Trigger progress bar animation on scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.querySelector('.animate-fill').style.animationPlayState = 'running';
            }
        });
    }, { threshold: 0.5 });

    const bar = document.getElementById('progress-bar-container');
    if (bar) {
        const fill = bar.querySelector('.animate-fill');
        fill.style.animationPlayState = 'paused';
        observer.observe(bar);
    }
</script>

</body>
</html>
